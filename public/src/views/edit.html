<div>
  <p>Game ID: {{curGame._id}}</p>
  <h4 ng-bind=" 'Time : ' + (curGame._id | mongoDate | date:'short') "></h4>
  <div class="row">
    <div class="col-md-6">
      <table class='table table-bordered table-striped table-hover'>
        <tr>
          <th colspan="2">
            General
          </th>
        </tr>
        <tr>
          <td>
            Name
          </td>
          <td>
            <input ng-disabled="authlevel<3" data-ng-model='curGame.name' class="form-control" placeholder="name">
          </td>
        </tr>
        <tr>
          <td>
            Description
          </td>
          <td>
            <textarea ng-disabled="authlevel<3" data-ng-model='curGame.description' class="form-control" placeholder="description"></textarea>
          </td>
        </tr>
        <tr>
          <td>
            The Blue Aliance Event Key
          </td>
          <td>
            <input ng-disabled="authlevel<3" data-ng-model='curGame.tbakey' class="form-control" placeholder="2015flor">
          </td>
        </tr>
        <tr ng-show="curGame.tbakey && !curGame.verification">
          <td>
            <a href="http://www.thebluealliance.com/webhooks/add">URL for live TBA updates</a>
          </td>
          <td>
            {{location.origin+'/api/game/'+curGame._id+'/TBAhook'}}
          </td>
        </tr>
        <tr ng-show="curGame.verification">
          <td>
            TBA verification key
          </td>
          <td>
            {{curGame.verification}}
          </td>
        </tr>
      </table>
    </div>
    <div class="col-md-6">
      <table class='table table-bordered table-striped table-hover'>
        <tr>
          <th colspan='2'>
            Permissions
          </th>
        </tr>
        <tr>
          <th>
            User
          </th>
          <th colspan="2">
            Authlevel
          </th>
        </tr>
        <tr>
          <td>
            <b>Default/Others</b>
          </td>
          <td>
            <select ng-disabled="authlevel<4" class="form-control" ng-model="curGame.permissions.others">
              <option value="0">(0) Blocked</option>
              <option value="1">(1) Can View</option>
              <option value="2">(2) Can add/edit submissions and teams</option>
              <option value="3">(3) Can edit game critieria</option>
              <option value="4">(4) Can change other user's permissions (Admin)</option>
            </select>
          </td>
        </tr>
        <tr ng-repeat="(key,value) in curGame.permissions.users">
          <td>
            {{key}}
          </td>
          <td>
            <select ng-disabled="authlevel<4" class="form-control" ng-model="curGame.permissions.users[key]">
              <option value="0">(0) Blocked</option>
              <option value="1">(1) Can View</option>
              <option value="2">(2) Can add/edit submissions and teams</option>
              <option value="3">(3) Can edit game critieria</option>
              <option value="4">(4) Can change other user's permissions (Admin)</option>
            </select>
          </td>
          <td>
            <button ng-disabled="authlevel<4" class='btn btn-sm btn-danger' data-ng-click="delPermission(key)">
              <span class='glyphicon glyphicon-minus-sign' aria-hidden="true"></span>
            </button>
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <input ng-disabled="authlevel<4" class="form-control" ng-model="newPermission">
          </td>
          <td>
            <button ng-disabled="authlevel<4" class="btn btn-sm btn-success" data-ng-click='curGame.permissions.users[newPermission] = curGame.permissions.users[newPermission] || 1; newPermission = ""; '>
              <span class='glyphicon glyphicon-plus-sign' aria-hidden="true"></span>
            </button>
          </td>
        </tr>
      </table>
    </div>
  </div>
  <div class='row'>
    <div class='col-md-5'>
      <table class='table table-bordered table-striped table-hover'>
        <tr>
          <th colspan='3'>Game Elements <p class="text-warning">WARNING! Changing these can mess up current submissions</p></th>
        </tr>
        <tr>
          <th>Name</th>
          <th colspan='2'>Data Type</th>
        </tr>
        <tr data-ng-repeat='x in curGame.game'>
          <td><input ng-disabled="authlevel<3" class="form-control" data-ng-model='x.name'></td>
          <td>
            <select ng-disabled="authlevel<3" class="form-control" data-ng-model='x.type'>
              <option>Number</option>
              <option>String</option>
              <option>Boolean</option>
            </select>
          </td>
          <td>
            <button ng-disabled="authlevel<3" class='btn btn-sm btn-danger' data-ng-click="curGame.game.splice($index,1)">
              <span class='glyphicon glyphicon-minus-sign' aria-hidden="true"></span>
            </button>
          </td>
        </tr>
        <tr>
          <td colspan='2'>
            <button ng-disabled="authlevel<3" class="btn btn-sm btn-success" data-ng-click='curGame.game.push({name:"",type:"String"})'>
              <span class='glyphicon glyphicon-plus-sign' aria-hidden="true"></span>
            </button>
          </td>
        </tr>
      </table>
    </div>
    <div class='col-md-7'>
      <table class='table table-bordered table-striped table-hover'>
        <tr><th colspan='3'>Calculated Elements</th></tr>
        <tr>
          <th>Name</th>
          <th colspan='2'>Elements</th>
        </tr>
        <tr data-ng-repeat='g in curGame.calc'>
          <td><input ng-disabled="authlevel<3" class="form-control" data-ng-model='g.name'></td>
          <td>
            <table>
              <tr>
                <td>Element</td>
                <td>Worth</td>
              </tr>
              <tr data-ng-repeat='p in g.elements'>
                <td>
                  <select ng-disabled="authlevel<3" class="form-control" data-ng-model='p.name'>
                    <option data-ng-repeat='L in curGame.game | filter: {type:"!String"} '>{{L.name}}</option>
                  </select>
                </td>
                <td><input ng-disabled="authlevel<3" class="form-control" type='number' data-ng-model='p.worth'></td>
                <td>
                  <button ng-disabled="authlevel<3" class='btn btn-sm btn-danger' data-ng-click='g.elements.splice($index,1)'>
                    <span class='glyphicon glyphicon-minus-sign' aria-hidden="true"></span>
                  </button>
                </td>
              </tr>
              <tr>
                <td>
                  <button ng-disabled="authlevel<3" class="btn btn-sm btn-success" data-ng-click='g.elements.push({name:"",worth:""})'>
                    <span class='glyphicon glyphicon-plus-sign' aria-hidden="true"></span>
                </button>
                </td>
              </tr>
            </table>
          </td>
          <td>
            <button ng-disabled="authlevel<3" class='btn btn-sm btn-danger' data-ng-click="curGame.calc.splice($index,1)">
              <span class='glyphicon glyphicon-minus-sign' aria-hidden="true"></span>
            </button>
          </td>
        </tr>
        <tr>
          <td colspan='3'>
            <button ng-disabled="authlevel<3" class="btn btn-sm btn-success" data-ng-click='curGame.calc.push({name:"",elements:[{name:"",worth:""}]})'>
              <span class='glyphicon glyphicon-plus-sign' aria-hidden="true"></span>
            </button>
          </td>
        </tr>
      </table>
    </div>
  </div>
  <hr>
  <button class='btn btn-primary' ng-disabled="authlevel<3" data-ng-click='editGame(curGame)'>Save Changes</button>
</div>
